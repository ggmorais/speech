(this.webpackJsonpspeech=this.webpackJsonpspeech||[]).push([[0],{10:function(e,t,a){e.exports={container:"logoff_container__1DvQi",username:"logoff_username__jvDwP",face:"logoff_face__3s3H-",options:"logoff_options__uVueO"}},11:function(e,t,a){e.exports={container:"NewMessage_container__3DJIL",flex:"NewMessage_flex__1o2b8",input:"NewMessage_input__2M8sI",button:"NewMessage_button__WXHp0"}},12:function(e,t,a){e.exports={container:"newroom_container__381t8",buttons:"newroom_buttons__1kp4_",roomInvite:"newroom_roomInvite__32TDV",createButton:"newroom_createButton__3smSE",addTitle:"newroom_addTitle__1oqt-"}},18:function(e,t,a){e.exports={container:"chat_container__3VIF0",blockLeft:"chat_blockLeft__2e7Wi",roomList:"chat_roomList__3uDZx"}},19:function(e,t,a){e.exports={label:"Input_label__3Vzt_",inputName:"Input_inputName__120sR",input:"Input_input__35tC6"}},20:function(e,t,a){e.exports={container:"Button_container__2XQtU",done:"Button_done__3Gjv6",cancel:"Button_cancel__18Hfd"}},21:function(e,t,a){e.exports={cover:"Layer_cover__2vWRI",content:"Layer_content__XCL0p",container:"Layer_container__3dVT9"}},45:function(e,t,a){e.exports={container:"Loading_container__1GWhn"}},46:function(e,t,a){e.exports={container:"Warning_container__297av"}},47:function(e,t,a){e.exports={warning:"labels_warning__fI7yB",buttonCancel:"labels_buttonCancel__2zuYs",buttonDone:"labels_buttonDone__3h8Tx"}},48:function(e,t,a){e.exports={error:"register_error__F0yT4"}},49:function(e,t,a){e.exports={container:"app_container__2Ym5M"}},50:function(e,t,a){e.exports=a(91)},7:function(e,t,a){e.exports={container:"list_container__2Z9xm",roomName:"list_roomName__2SO5q",lastMessage:"list_lastMessage__fD8I0",postDate:"list_postDate__FdLYd",roomList:"list_roomList__1Z8Mu"}},8:function(e,t,a){e.exports={messageList:"Message_messageList__1LeUL",messageInfos:"Message_messageInfos__1i5bs",message:"Message_message__vzC4T",messageOwner:"Message_messageOwner__24rZr",messageBody:"Message_messageBody__1vxAB",postDate:"Message_postDate__2e6bE"}},83:function(e,t){},89:function(e,t,a){e.exports={container:"login_container__I3WY5",form:"login_form__1Aw7y",label:"login_label__1x7WU",inputName:"login_inputName__1w1vG",input:"login_input__1QTob"}},9:function(e,t,a){e.exports={container:"window_container__1d7n6",window:"window_window__1B63q",newMessage:"window_newMessage__3YLm1",messageList:"window_messageList__1Akky",messageInfos:"window_messageInfos__3R1H6",message:"window_message__1iSYl",messageOwner:"window_messageOwner__3_gW4",messageBody:"window_messageBody__S16EY",invite:"window_invite__2wYw0",closeInvite:"window_closeInvite__3gmGM"}},90:function(e,t,a){},91:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(44),o=a.n(r),c=a(27),i=a.n(c),l=a(2),u=a.n(l),m=a(1),d=a(3),_=function(){var e=window.location.hash;if(e.length<=1)return!1;if(e.includes("=")){var t=(e=e.substr(1,e.length)).split("=");return Object(d.a)({},t[0],t[1])}return e=e.substr(1,e.length),Object(d.a)({},e,!0)},g="http://172.21.102.243:5000/api",f="http://172.21.102.243:5000",p=a(13),h=a(16),v=a.n(h),w=i()(f),b=Object(n.createContext)(),E=function(e){var t=localStorage.getItem("@speech/token"),a=Object(n.useState)(!1),r=Object(m.a)(a,2),o=r[0],c=r[1],i=Object(n.useState)([]),l=Object(m.a)(i,2),u=l[0],d=l[1],_=Object(n.useState)(!0),g=Object(m.a)(_,2),f=g[0],h=(g[1],Object(n.useState)(localStorage.getItem("@speech/room"))),E=Object(m.a)(h,2),y=E[0],O=E[1],N=Object(n.useState)(""),j=Object(m.a)(N,2),x=j[0],C=j[1];try{C(v()(t))}catch(k){}var S=function(e){localStorage.setItem("@speech/room",e),O(e),w.emit("selectedRoom",e)};return Object(n.useEffect)((function(){S(y),w.emit("userId",x._id),w.on("roomList",(function(e){console.log("receiving new roomList");var t,a=(t=(t=e).sort((function(e,t){return e.messages.length<1||t.messages.length<1?0:new Date(e.messages[0].postDate)-new Date(t.messages[0].postDate)})),console.log(t),t);c(a)}))}),[]),Object(n.useEffect)((function(){return w.on("newMessage",(function(e){console.log("receiving new message"),function(e){var t=Object(p.a)(u);for(var a in t)t[a]._id===e._id&&t[a].messages.push(e.messages[0]);d(t)}(e)})),function(){return w.off("newMessage")}})),Object(n.useEffect)((function(){return w.on("roomData",(function(e){return function(e){var t=Object(p.a)(u),a=!1;if(0!=u.length){var n=!0,s=!1,r=void 0;try{for(var o,c=t[Symbol.iterator]();!(n=(o=c.next()).done);n=!0){o.value._id===e[0]._id&&(a=!0)}}catch(k){s=!0,r=k}finally{try{n||null==c.return||c.return()}finally{if(s)throw r}}a||(t.push(e[0]),d(t))}else d(e)}(e)})),function(){return w.off("roomData")}})),Object(n.useEffect)((function(){if(o&&!(u.length<1)){var e=Object(p.a)(o);for(var t in e)for(var a in u)u[a]._id===e[t]._id&&u[a].messages.length>0&&e[t].messages.length>0&&u[a].messages[u[a].messages.length-1]._id!==e[t].messages[e[t].messages.length-1]._id&&e[t].messages.push(u[a].messages[u[a].messages.length-1]);c(e)}}),[u]),Object(n.useEffect)((function(){!function(e){var t=document.querySelector(e);t.scrollTo(0,t.scrollHeight)}("#messages")})),s.a.createElement(b.Provider,{value:{roomList:o,roomData:u,user:x,token:t,selectedRoom:y,selectRoom:S,isLoading:f,sendNewMessage:function(e,t){var a=Object(p.a)(u);for(var n in a)a[n]._id===e&&a[n].messages.push({_id:e+a[n].messages.length+1,postDate:Date.now(),body:t,user:x});d(a),w.emit("newMessage",{userId:x._id,roomId:e,body:t})}}},e.children)},y=a(18),O=a.n(y),N=a(6),j=a(10),x=a.n(j),C=function(e){var t=Object(n.useContext)(b).user,a=Object(n.useState)(!1),r=Object(m.a)(a,2),o=r[0],c=r[1];return s.a.createElement("div",{className:x.a.container},s.a.createElement(N.c,{size:"40px",className:x.a.face}),s.a.createElement("p",{className:x.a.username,onClick:function(){return c(!o)}},t.username),o&&s.a.createElement("div",{className:x.a.options},s.a.createElement("p",{onClick:function(e){e.preventDefault(),localStorage.setItem("@speech/token",!1),window.location.reload()}},"Logout")))},S=function(e){return s.a.createElement(C,e)},k=a(19),I=a.n(k),L=a(20),D=a.n(L),M=a(21),T=a.n(M),B=a(11),R=a.n(B),z=a(8),Y=a.n(z),P=a(45),W=a.n(P),H=a(46),J=a.n(H),U=function(e){return s.a.createElement("div",{className:I.a.label},s.a.createElement("p",{className:I.a.inputName},e.title),s.a.createElement("input",{style:{borderRadius:e.rounded&&e.rounded,width:e.width&&e.width},className:I.a.input,type:e.type,name:e.name,onChange:e.onChange,value:e.value}))},V=function(e){return s.a.createElement("p",{className:D.a.container},s.a.createElement("button",{onClick:e.onClick,className:e.cancel?D.a.cancel:D.a.done,style:{width:e.width&&e.width,borderRadius:e.rounded&&e.rounded}},e.title))},q=function(e){return s.a.createElement("div",{className:T.a.cover,style:{display:!e.show&&"none"}},s.a.createElement("div",{className:T.a.content},s.a.createElement("div",{className:T.a.container,style:{padding:e.pd&&e.pd}},e.children)))},A=function(e){return s.a.createElement("div",{className:R.a.container},s.a.createElement("div",{className:R.a.flex},s.a.createElement("input",{className:R.a.input,type:"text",value:e.value,onChange:e.onChange}),s.a.createElement("button",{className:R.a.button,onClick:e.onClick},"OK")))},F=function(e){return s.a.createElement("li",{className:Y.a.messageInfos,style:{justifyContent:e.right&&"flex-end"}},s.a.createElement("div",{className:Y.a.message},s.a.createElement("a",{className:Y.a.messageOwner},e.username),s.a.createElement("p",{className:Y.a.messageBody},e.body," ",s.a.createElement("span",{className:Y.a.postDate},e.postDate))))},G=function(e){return s.a.createElement("div",{className:W.a.container,style:{height:e.size&&e.size,width:e.use&&e.use,display:e.hide&&"none",marginTop:e.top&&e.top,marginLeft:e.left&&e.left,marginRight:e.right&&e.right,marginBottom:e.bottom&&e.bottom}})},Z=function(e){return s.a.createElement("div",{className:J.a.container,style:{marginTop:e.top&&e.top}},e.children)},Q=a(12),X=a.n(Q),K=function(e){return s.a.createElement("div",null,s.a.createElement("div",{className:X.a.createButton,onClick:e.handleLayer},s.a.createElement(N.a,{size:"40px"})," ",s.a.createElement("span",{className:X.a.addTitle},"New Room")),s.a.createElement(q,{show:e.layer},s.a.createElement("h2",null,e.invite&&"Room created!"),e.invite&&s.a.createElement("p",{className:X.a.roomInvite},"Send your room invitation to other people: ",s.a.createElement("a",{href:e.invite},e.invite)),s.a.createElement(U,{title:"Room name",type:"text",name:"name",value:e.roomName,onChange:e.handleChanges}),s.a.createElement("div",{className:X.a.buttons},s.a.createElement(V,{cancel:!0,title:"Cancel",onClick:e.handleLayer}),s.a.createElement(V,{title:"Create",onClick:e.handleSubmit}))))},$=function(e){var t=Object(n.useState)(!1),a=Object(m.a)(t,2),r=a[0],o=a[1],c=Object(n.useState)(""),i=Object(m.a)(c,2),l=i[0],d=i[1],_=Object(n.useState)(""),f=Object(m.a)(_,2),p=f[0],h=f[1],v=Object(n.useContext)(b),w=v.user,E=v.fetchRooms;return s.a.createElement(K,{roomName:l,handleChanges:function(e){d(e.target.value)},handleSubmit:function(e){var t,a;return u.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.preventDefault(),!(l.length<3)){n.next=3;break}return n.abrupt("return");case 3:return n.next=5,u.a.awrap(fetch(g+"/rooms",{method:"POST",headers:{"Content-Type":"application/json",authorization:localStorage.getItem("@speech/token")},body:JSON.stringify({name:l,userId:w._id})}));case 5:return t=n.sent,n.next=8,u.a.awrap(t.json());case 8:(a=n.sent)&&h("http://localhost:3000/#room="+a._id),200===t.status&&(d(""),E());case 11:case"end":return n.stop()}}))},handleLayer:function(e){o(!r)},layer:r,invite:p})},ee=function(e){return s.a.createElement($,null)},te=a(7),ae=a.n(te),ne=function(e){return s.a.createElement("div",{className:ae.a.container,onClick:e.handleSelect.bind(void 0,e._id),style:{backgroundColor:e.isSelected&&"#adc6e840"}},s.a.createElement("p",{className:ae.a.roomName},e.name),s.a.createElement("p",{className:ae.a.lastMessage},e.lastMessage&&e.sender+": "+e.lastMessage,s.a.createElement("span",{className:ae.a.postDate},e.postDate)))},se=function(e){var t=new Date(e);return t=t.getHours()+":"+t.getMinutes()},re=function(e){var t=Object(n.useContext)(b),a=t.selectRoom,r=(t.selectedRoom,t.user),o=t.isLoading,c=t.roomList,i=function(e){a(e)};return c.length?c.map((function(e){var t,a,n;if(e.messages.length>0){var o=e.messages[e.messages.length-1];t=o.user.username,a=o.body,n=o.postDate,t===r.username&&(t="You"),a.length>10&&(a=a.slice(0,11)+" ...")}return s.a.createElement(ne,Object.assign({},e,{key:e._id,handleSelect:i,isSelected:void 0,username:r.username,sender:t,lastMessage:a,postDate:n&&se(n)}))})):o&&s.a.createElement(G,null)},oe=function(e){return s.a.createElement(re,null)},ce=a(9),ie=a.n(ce),le=function(e){var t=Object(n.useState)(""),a=Object(m.a)(t,2),r=a[0],o=a[1],c=Object(n.useState)(!0),i=Object(m.a)(c,2),l=i[0],d=i[1],_=Object(n.useContext)(b),g=_.user,f=_.selectedRoom,p=_.isLoading,h=_.sendNewMessage,v=_.roomData,w=[];if(v.length){var E=!0,y=!1,O=void 0;try{for(var j,x=v[Symbol.iterator]();!(E=(j=x.next()).done);E=!0){var C=j.value;C._id===f&&(w=C.messages)}}catch(S){y=!0,O=S}finally{try{E||null==x.return||x.return()}finally{if(y)throw O}}}return Object(n.useEffect)((function(){d(!0)}),[f]),s.a.createElement("div",{className:ie.a.container},s.a.createElement("div",{className:ie.a.invite},l&&s.a.createElement("p",null,"Invite other people to this room:",s.a.createElement("a",{href:window.location.href+"#room="+f},window.location.href+"#room="+f),s.a.createElement(N.b,{color:"red",size:"20px",className:ie.a.closeInvite,onClick:function(){return d(!l)}}))),s.a.createElement("div",{className:ie.a.window},s.a.createElement("div",null,s.a.createElement("ul",{className:ie.a.messageList,id:"messages"},w.length?w.map((function(e){return s.a.createElement(F,{key:e._id,username:e.user.username!==g.username&&e.user.username,right:e.user.username===g.username&&!0,body:e.body,postDate:se(e.postDate)})})):!p&&s.a.createElement(Z,{top:"25%"},"This room does not have messages yet, be the first sanding one now!"))),s.a.createElement(A,{onChange:function(e){o(e.target.value)},onClick:function(e){return u.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==r.length){e.next=2;break}return e.abrupt("return");case 2:h(f,r),o("");case 4:case"end":return e.stop()}}))},value:r})))},ue=function(e){return s.a.createElement(le,null)},me=function(e){return s.a.createElement("div",{className:O.a.container},s.a.createElement("div",{className:O.a.blockLeft},s.a.createElement(S,null),s.a.createElement(ee,null),s.a.createElement("div",{className:O.a.roomList},s.a.createElement(oe,null))),s.a.createElement(ue,null))},de=a(17),_e=(a(89),a(47)),ge=a.n(_e),fe=function(e){return s.a.createElement(q,{show:!0},s.a.createElement("h2",null,"Login in your account"),s.a.createElement("p",{className:ge.a.warning,style:{display:e.message?"block":"none"}},e.message),s.a.createElement(U,{title:"Username",type:"text",name:"username",onChange:e.handleChanges,value:e.changes.username}),s.a.createElement(U,{title:"Password",type:"password",name:"password",onChange:e.handleChanges,value:e.changes.password}),s.a.createElement(V,{title:"Login",width:"80%",onClick:e.handleSubmit}),s.a.createElement("a",{href:"/#register",onClick:function(){window.location.replace("/#register"),window.location.reload()}},"Create an account"))},pe=function(e){var t=s.a.useState({username:"",password:""}),a=Object(m.a)(t,2),n=a[0],r=a[1],o=s.a.useState(""),c=Object(m.a)(o,2),i=c[0],l=c[1];return s.a.createElement(fe,{changes:n,handleChanges:function(e){var t=e.target,a=t.name,s=t.value;"undefined"!==typeof n[a]&&r(Object(de.a)({},n,Object(d.a)({},a,s)))},handleSubmit:function(t){var a,s,o,c,i;return u.a.async((function(m){for(;;)switch(m.prev=m.next){case 0:return t.preventDefault(),m.next=3,u.a.awrap(fetch(g+"/users/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}));case 3:return a=m.sent,s=a.status,m.next=7,u.a.awrap(a.json());case 7:o=m.sent,c=o.message,i=o.token,401===s?(l(c),r({username:"",password:""})):200===s&&(localStorage.setItem("@speech/token",i),e.show(!1));case 11:case"end":return m.stop()}}))},message:i})},he=function(e){return s.a.createElement(pe,e)},ve=a(48),we=a.n(ve),be=function(e){var t=Object(n.useState)({username:"",password:""}),a=Object(m.a)(t,2),r=a[0],o=a[1],c=Object(n.useState)(""),i=Object(m.a)(c,2),l=i[0],_=i[1],f=function(e){var t=e.target,a=t.name,n=t.value;o(Object(de.a)({},r,Object(d.a)({},a,n)))};return s.a.createElement(s.a.Fragment,null,s.a.createElement(q,{show:!0},s.a.createElement("p",{className:we.a.error},l),s.a.createElement("h2",null,"Create your account"),s.a.createElement(U,{type:"text",name:"username",title:"Username",onChange:f,value:r.username}),s.a.createElement(U,{type:"password",name:"password",title:"Password",onChange:f,value:r.password}),s.a.createElement(V,{title:"Create",onClick:function(e){var t,a,n,s;return u.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(e.preventDefault(),!((null===(t=r.username)||void 0===t?void 0:t.length)<4||(null===(a=r.username)||void 0===a?void 0:a.length)<4)){o.next=3;break}return o.abrupt("return");case 3:return o.next=5,u.a.awrap(fetch(g+"/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}));case 5:if(n=o.sent,500!==(s=n.status)&&401!==s){o.next=9;break}return o.abrupt("return",_("Username already in use"));case 9:window.location.replace("/");case 10:case"end":return o.stop()}}))},width:"80%"}),s.a.createElement("a",{href:"/"},"Log in")))},Ee=function(e){var t=s.a.useState(!1),a=Object(m.a)(t,2),r=a[0],o=a[1],c=localStorage.getItem("@speech/token"),i=_();return Object(n.useEffect)((function(){c?function(){var e,t,a;return u.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(!((e=localStorage.getItem("@speech/token")).length<10)){n.next=3;break}return n.abrupt("return",!1);case 3:return n.next=5,u.a.awrap(fetch(g+"/users/validation",{headers:{authorization:e}}));case 5:return t=n.sent,a=t.status,n.abrupt("return",401!==a);case 8:case"end":return n.stop()}}))}().then((function(e){e?o(!1):(localStorage.removeItem("@speech/token"),o(!0))})):o(!0)}),[]),i.room?(u.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.awrap(fetch(g+"/rooms/e/"+i.room,{method:"PATCH",headers:{"Content-Type":"application/json",authorization:c},body:JSON.stringify({userId:v()(c)._id})}));case 2:200===e.sent.status&&(localStorage.setItem("@speech/room",i.room),window.location.replace("http://localhost:3000"));case 4:case"end":return e.stop()}})),s.a.createElement("div",null)):i.register?s.a.createElement(be,null):r?s.a.createElement(he,{show:o}):s.a.createElement(E,null,s.a.createElement(me,null))},ye=function(){return s.a.createElement(Ee,null)},Oe=a(49),Ne=a.n(Oe);var je=function(){return s.a.createElement("div",{className:Ne.a.container},s.a.createElement(ye,null))};a(90);o.a.render(s.a.createElement(je,null),document.getElementById("root"))}},[[50,1,2]]]);
//# sourceMappingURL=main.e3703c42.chunk.js.map