(this.webpackJsonpspeech=this.webpackJsonpspeech||[]).push([[0],{10:function(e,t,a){e.exports={container:"logoff_container__2Cj8A",username:"logoff_username__2WaCI",face:"logoff_face__3y0ce",options:"logoff_options__3t__h"}},11:function(e,t,a){e.exports={container:"NewMessage_container__53f2N",flex:"NewMessage_flex__3-vtb",input:"NewMessage_input__FzQeb",button:"NewMessage_button__2rpIn"}},12:function(e,t,a){e.exports={container:"newroom_container__2N0SO",buttons:"newroom_buttons__123Li",roomInvite:"newroom_roomInvite__NohiU",createButton:"newroom_createButton__2TmG4",addTitle:"newroom_addTitle__1aK6Z"}},18:function(e,t,a){e.exports={container:"chat_container__KmX4A",blockLeft:"chat_blockLeft__2Zb-L",roomList:"chat_roomList__1i9Ae"}},19:function(e,t,a){e.exports={label:"Input_label__10_S3",inputName:"Input_inputName__1agUU",input:"Input_input__UYxPW"}},20:function(e,t,a){e.exports={container:"Button_container__1LmH_",done:"Button_done__3CZCw",cancel:"Button_cancel__34MgP"}},21:function(e,t,a){e.exports={cover:"Layer_cover__375Ev",content:"Layer_content__1GF3D",container:"Layer_container__2cxyL"}},45:function(e,t,a){e.exports={container:"Loading_container__2CvYT"}},46:function(e,t,a){e.exports={container:"Warning_container__3CIFJ"}},47:function(e,t,a){e.exports={warning:"labels_warning__1iI4i",buttonCancel:"labels_buttonCancel__aGyld",buttonDone:"labels_buttonDone__10G4j"}},48:function(e,t,a){e.exports={error:"register_error__31EDD"}},49:function(e,t,a){e.exports={container:"app_container__3P-bh"}},50:function(e,t,a){e.exports=a(91)},7:function(e,t,a){e.exports={container:"list_container__BDOuH",roomName:"list_roomName__gwcaL",lastMessage:"list_lastMessage__1P1Hp",postDate:"list_postDate__2C7BV",roomList:"list_roomList__3lGFT"}},8:function(e,t,a){e.exports={messageList:"Message_messageList__1NGbJ",messageInfos:"Message_messageInfos__2hMnp",message:"Message_message__327Uk",messageOwner:"Message_messageOwner__26o5H",messageBody:"Message_messageBody__2pF6B",postDate:"Message_postDate__1BBf-"}},83:function(e,t){},89:function(e,t,a){e.exports={container:"login_container__1Kxti",form:"login_form__3Nj7_",label:"login_label__3AhDA",inputName:"login_inputName__3puRa",input:"login_input__2Csyp"}},9:function(e,t,a){e.exports={container:"window_container__27u37",window:"window_window__18nQD",newMessage:"window_newMessage__20d4H",messageList:"window_messageList__3Uyjn",messageInfos:"window_messageInfos__1oWlV",message:"window_message__2i1UJ",messageOwner:"window_messageOwner__1bgV0",messageBody:"window_messageBody__tmYeX",invite:"window_invite__3-cZi",closeInvite:"window_closeInvite__1uQi6"}},90:function(e,t,a){},91:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(44),o=a.n(r),c=a(27),i=a.n(c),l=a(2),u=a.n(l),m=a(1),d=a(3),_=function(){var e=window.location.hash;if(e.length<=1)return!1;if(e.includes("=")){var t=(e=e.substr(1,e.length)).split("=");return Object(d.a)({},t[0],t[1])}return e=e.substr(1,e.length),Object(d.a)({},e,!0)},g="http://speech-restapi.herokuapp.com/api",p="http://speech-restapi.herokuapp.com",f=a(13),h=a(16),v=a.n(h),b=i()(p),w=Object(n.createContext)(),E=function(e){var t=localStorage.getItem("@speech/token"),a=Object(n.useState)(!1),r=Object(m.a)(a,2),o=r[0],c=r[1],i=Object(n.useState)([]),l=Object(m.a)(i,2),u=l[0],d=l[1],_=Object(n.useState)(!0),g=Object(m.a)(_,2),p=g[0],h=(g[1],Object(n.useState)(localStorage.getItem("@speech/room"))),E=Object(m.a)(h,2),y=E[0],N=E[1],O=Object(n.useState)(""),j=Object(m.a)(O,2),C=j[0],x=j[1];try{x(v()(t))}catch(k){}var S=function(e){localStorage.setItem("@speech/room",e),N(e),b.emit("selectedRoom",e)};return Object(n.useEffect)((function(){S(y),b.emit("userId",C._id),b.on("roomList",(function(e){console.log("receiving new roomList");var t,a=(t=(t=e).sort((function(e,t){return e.messages.length<1||t.messages.length<1?0:new Date(e.messages[0].postDate)-new Date(t.messages[0].postDate)})),console.log(t),t);c(a)}))}),[]),Object(n.useEffect)((function(){return b.on("newMessage",(function(e){console.log("receiving new message"),function(e){var t=Object(f.a)(u);for(var a in t)t[a]._id===e._id&&t[a].messages.push(e.messages[0]);d(t)}(e)})),function(){return b.off("newMessage")}})),Object(n.useEffect)((function(){return b.on("roomData",(function(e){return function(e){var t=Object(f.a)(u),a=!1;if(0!=u.length){var n=!0,s=!1,r=void 0;try{for(var o,c=t[Symbol.iterator]();!(n=(o=c.next()).done);n=!0){o.value._id===e[0]._id&&(a=!0)}}catch(k){s=!0,r=k}finally{try{n||null==c.return||c.return()}finally{if(s)throw r}}a||(t.push(e[0]),d(t))}else d(e)}(e)})),function(){return b.off("roomData")}})),Object(n.useEffect)((function(){if(o&&!(u.length<1)){var e=Object(f.a)(o);for(var t in e)for(var a in u)u[a]._id===e[t]._id&&u[a].messages.length>0&&e[t].messages.length>0&&u[a].messages[u[a].messages.length-1]._id!==e[t].messages[e[t].messages.length-1]._id&&e[t].messages.push(u[a].messages[u[a].messages.length-1]);c(e)}}),[u]),Object(n.useEffect)((function(){!function(e){var t=document.querySelector(e);t.scrollTo(0,t.scrollHeight)}("#messages")})),s.a.createElement(w.Provider,{value:{roomList:o,roomData:u,user:C,token:t,selectedRoom:y,selectRoom:S,isLoading:p,sendNewMessage:function(e,t){var a=Object(f.a)(u);for(var n in a)a[n]._id===e&&a[n].messages.push({_id:e+a[n].messages.length+1,postDate:Date.now(),body:t,user:C});d(a),b.emit("newMessage",{userId:C._id,roomId:e,body:t})}}},e.children)},y=a(18),N=a.n(y),O=a(6),j=a(10),C=a.n(j),x=function(e){var t=Object(n.useContext)(w).user,a=Object(n.useState)(!1),r=Object(m.a)(a,2),o=r[0],c=r[1];return s.a.createElement("div",{className:C.a.container},s.a.createElement(O.c,{size:"40px",className:C.a.face}),s.a.createElement("p",{className:C.a.username,onClick:function(){return c(!o)}},t.username),o&&s.a.createElement("div",{className:C.a.options},s.a.createElement("p",{onClick:function(e){e.preventDefault(),localStorage.setItem("@speech/token",!1),window.location.reload()}},"Logout")))},S=function(e){return s.a.createElement(x,e)},k=a(19),L=a.n(k),D=a(20),I=a.n(D),M=a(21),B=a.n(M),T=a(11),R=a.n(T),P=a(8),U=a.n(P),z=a(45),J=a.n(z),H=a(46),A=a.n(H),F=function(e){return s.a.createElement("div",{className:L.a.label},s.a.createElement("p",{className:L.a.inputName},e.title),s.a.createElement("input",{style:{borderRadius:e.rounded&&e.rounded,width:e.width&&e.width},className:L.a.input,type:e.type,name:e.name,onChange:e.onChange,value:e.value}))},G=function(e){return s.a.createElement("p",{className:I.a.container},s.a.createElement("button",{onClick:e.onClick,className:e.cancel?I.a.cancel:I.a.done,style:{width:e.width&&e.width,borderRadius:e.rounded&&e.rounded}},e.title))},K=function(e){return s.a.createElement("div",{className:B.a.cover,style:{display:!e.show&&"none"}},s.a.createElement("div",{className:B.a.content},s.a.createElement("div",{className:B.a.container,style:{padding:e.pd&&e.pd}},e.children)))},W=function(e){return s.a.createElement("div",{className:R.a.container},s.a.createElement("div",{className:R.a.flex},s.a.createElement("input",{className:R.a.input,type:"text",value:e.value,onChange:e.onChange}),s.a.createElement("button",{className:R.a.button,onClick:e.onClick},"OK")))},Y=function(e){return s.a.createElement("li",{className:U.a.messageInfos,style:{justifyContent:e.right&&"flex-end"}},s.a.createElement("div",{className:U.a.message},s.a.createElement("a",{className:U.a.messageOwner},e.username),s.a.createElement("p",{className:U.a.messageBody},e.body," ",s.a.createElement("span",{className:U.a.postDate},e.postDate))))},Z=function(e){return s.a.createElement("div",{className:J.a.container,style:{height:e.size&&e.size,width:e.use&&e.use,display:e.hide&&"none",marginTop:e.top&&e.top,marginLeft:e.left&&e.left,marginRight:e.right&&e.right,marginBottom:e.bottom&&e.bottom}})},Q=function(e){return s.a.createElement("div",{className:A.a.container,style:{marginTop:e.top&&e.top}},e.children)},V=a(12),X=a.n(V),q=function(e){return s.a.createElement("div",null,s.a.createElement("div",{className:X.a.createButton,onClick:e.handleLayer},s.a.createElement(O.a,{size:"40px"})," ",s.a.createElement("span",{className:X.a.addTitle},"New Room")),s.a.createElement(K,{show:e.layer},s.a.createElement("h2",null,e.invite&&"Room created!"),e.invite&&s.a.createElement("p",{className:X.a.roomInvite},"Send your room invitation to other people: ",s.a.createElement("a",{href:e.invite},e.invite)),s.a.createElement(F,{title:"Room name",type:"text",name:"name",value:e.roomName,onChange:e.handleChanges}),s.a.createElement("div",{className:X.a.buttons},s.a.createElement(G,{cancel:!0,title:"Cancel",onClick:e.handleLayer}),s.a.createElement(G,{title:"Create",onClick:e.handleSubmit}))))},$=function(e){var t=Object(n.useState)(!1),a=Object(m.a)(t,2),r=a[0],o=a[1],c=Object(n.useState)(""),i=Object(m.a)(c,2),l=i[0],d=i[1],_=Object(n.useState)(""),p=Object(m.a)(_,2),f=p[0],h=p[1],v=Object(n.useContext)(w),b=v.user,E=v.fetchRooms;return s.a.createElement(q,{roomName:l,handleChanges:function(e){d(e.target.value)},handleSubmit:function(e){var t,a;return u.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.preventDefault(),!(l.length<3)){n.next=3;break}return n.abrupt("return");case 3:return n.next=5,u.a.awrap(fetch(g+"/rooms",{method:"POST",headers:{"Content-Type":"application/json",authorization:localStorage.getItem("@speech/token")},body:JSON.stringify({name:l,userId:b._id})}));case 5:return t=n.sent,n.next=8,u.a.awrap(t.json());case 8:(a=n.sent)&&h("http://localhost:3000/#room="+a._id),200===t.status&&(d(""),E());case 11:case"end":return n.stop()}}))},handleLayer:function(e){o(!r)},layer:r,invite:f})},ee=function(e){return s.a.createElement($,null)},te=a(7),ae=a.n(te),ne=function(e){return s.a.createElement("div",{className:ae.a.container,onClick:e.handleSelect.bind(void 0,e._id),style:{backgroundColor:e.isSelected&&"#adc6e840"}},s.a.createElement("p",{className:ae.a.roomName},e.name),s.a.createElement("p",{className:ae.a.lastMessage},e.lastMessage&&e.sender+": "+e.lastMessage,s.a.createElement("span",{className:ae.a.postDate},e.postDate)))},se=function(e){var t=new Date(e);return t=t.getHours()+":"+t.getMinutes()},re=function(e){var t=Object(n.useContext)(w),a=t.selectRoom,r=(t.selectedRoom,t.user),o=t.isLoading,c=t.roomList,i=function(e){a(e)};return c.length?c.map((function(e){var t,a,n;if(e.messages.length>0){var o=e.messages[e.messages.length-1];t=o.user.username,a=o.body,n=o.postDate,t===r.username&&(t="You"),a.length>10&&(a=a.slice(0,11)+" ...")}return s.a.createElement(ne,Object.assign({},e,{key:e._id,handleSelect:i,isSelected:void 0,username:r.username,sender:t,lastMessage:a,postDate:n&&se(n)}))})):o&&s.a.createElement(Z,null)},oe=function(e){return s.a.createElement(re,null)},ce=a(9),ie=a.n(ce),le=function(e){var t=Object(n.useState)(""),a=Object(m.a)(t,2),r=a[0],o=a[1],c=Object(n.useState)(!0),i=Object(m.a)(c,2),l=i[0],d=i[1],_=Object(n.useContext)(w),g=_.user,p=_.selectedRoom,f=_.isLoading,h=_.sendNewMessage,v=_.roomData,b=[];if(v.length){var E=!0,y=!1,N=void 0;try{for(var j,C=v[Symbol.iterator]();!(E=(j=C.next()).done);E=!0){var x=j.value;x._id===p&&(b=x.messages)}}catch(S){y=!0,N=S}finally{try{E||null==C.return||C.return()}finally{if(y)throw N}}}return Object(n.useEffect)((function(){d(!0)}),[p]),s.a.createElement("div",{className:ie.a.container},s.a.createElement("div",{className:ie.a.invite},l&&s.a.createElement("p",null,"Invite other people to this room:",s.a.createElement("a",{href:window.location.href+"#room="+p},window.location.href+"#room="+p),s.a.createElement(O.b,{color:"red",size:"20px",className:ie.a.closeInvite,onClick:function(){return d(!l)}}))),s.a.createElement("div",{className:ie.a.window},s.a.createElement("div",null,s.a.createElement("ul",{className:ie.a.messageList,id:"messages"},b.length?b.map((function(e){return s.a.createElement(Y,{key:e._id,username:e.user.username!==g.username&&e.user.username,right:e.user.username===g.username&&!0,body:e.body,postDate:se(e.postDate)})})):!f&&s.a.createElement(Q,{top:"25%"},"This room does not have messages yet, be the first sanding one now!"))),s.a.createElement(W,{onChange:function(e){o(e.target.value)},onClick:function(e){return u.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==r.length){e.next=2;break}return e.abrupt("return");case 2:h(p,r),o("");case 4:case"end":return e.stop()}}))},value:r})))},ue=function(e){return s.a.createElement(le,null)},me=function(e){return s.a.createElement("div",{className:N.a.container},s.a.createElement("div",{className:N.a.blockLeft},s.a.createElement(S,null),s.a.createElement(ee,null),s.a.createElement("div",{className:N.a.roomList},s.a.createElement(oe,null))),s.a.createElement(ue,null))},de=a(17),_e=(a(89),a(47)),ge=a.n(_e),pe=function(e){return s.a.createElement(K,{show:!0},s.a.createElement("h2",null,"Login in your account"),s.a.createElement("p",{className:ge.a.warning,style:{display:e.message?"block":"none"}},e.message),s.a.createElement(F,{title:"Username",type:"text",name:"username",onChange:e.handleChanges,value:e.changes.username}),s.a.createElement(F,{title:"Password",type:"password",name:"password",onChange:e.handleChanges,value:e.changes.password}),s.a.createElement(G,{title:"Login",width:"80%",onClick:e.handleSubmit}),s.a.createElement("a",{href:"/#register",onClick:function(){window.location.replace("/#register"),window.location.reload()}},"Create an account"))},fe=function(e){var t=s.a.useState({username:"",password:""}),a=Object(m.a)(t,2),n=a[0],r=a[1],o=s.a.useState(""),c=Object(m.a)(o,2),i=c[0],l=c[1];return s.a.createElement(pe,{changes:n,handleChanges:function(e){var t=e.target,a=t.name,s=t.value;"undefined"!==typeof n[a]&&r(Object(de.a)({},n,Object(d.a)({},a,s)))},handleSubmit:function(t){var a,s,o,c,i;return u.a.async((function(m){for(;;)switch(m.prev=m.next){case 0:return t.preventDefault(),m.next=3,u.a.awrap(fetch(g+"/users/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}));case 3:return a=m.sent,s=a.status,m.next=7,u.a.awrap(a.json());case 7:o=m.sent,c=o.message,i=o.token,401===s?(l(c),r({username:"",password:""})):200===s&&(localStorage.setItem("@speech/token",i),e.show(!1));case 11:case"end":return m.stop()}}))},message:i})},he=function(e){return s.a.createElement(fe,e)},ve=a(48),be=a.n(ve),we=function(e){var t=Object(n.useState)({username:"",password:""}),a=Object(m.a)(t,2),r=a[0],o=a[1],c=Object(n.useState)(""),i=Object(m.a)(c,2),l=i[0],_=i[1],p=function(e){var t=e.target,a=t.name,n=t.value;o(Object(de.a)({},r,Object(d.a)({},a,n)))};return s.a.createElement(s.a.Fragment,null,s.a.createElement(K,{show:!0},s.a.createElement("p",{className:be.a.error},l),s.a.createElement("h2",null,"Create your account"),s.a.createElement(F,{type:"text",name:"username",title:"Username",onChange:p,value:r.username}),s.a.createElement(F,{type:"password",name:"password",title:"Password",onChange:p,value:r.password}),s.a.createElement(G,{title:"Create",onClick:function(e){var t,a,n,s;return u.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(e.preventDefault(),!((null===(t=r.username)||void 0===t?void 0:t.length)<4||(null===(a=r.username)||void 0===a?void 0:a.length)<4)){o.next=3;break}return o.abrupt("return");case 3:return o.next=5,u.a.awrap(fetch(g+"/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}));case 5:if(n=o.sent,500!==(s=n.status)&&401!==s){o.next=9;break}return o.abrupt("return",_("Username already in use"));case 9:window.location.replace("/");case 10:case"end":return o.stop()}}))},width:"80%"}),s.a.createElement("a",{href:"/"},"Log in")))},Ee=function(e){var t=s.a.useState(!1),a=Object(m.a)(t,2),r=a[0],o=a[1],c=localStorage.getItem("@speech/token"),i=_();return Object(n.useEffect)((function(){c?function(){var e,t,a;return u.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(!((e=localStorage.getItem("@speech/token")).length<10)){n.next=3;break}return n.abrupt("return",!1);case 3:return n.next=5,u.a.awrap(fetch(g+"/users/validation",{headers:{authorization:e}}));case 5:return t=n.sent,a=t.status,n.abrupt("return",401!==a);case 8:case"end":return n.stop()}}))}().then((function(e){e?o(!1):(localStorage.removeItem("@speech/token"),o(!0))})):o(!0)}),[]),i.room?(u.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.awrap(fetch(g+"/rooms/e/"+i.room,{method:"PATCH",headers:{"Content-Type":"application/json",authorization:c},body:JSON.stringify({userId:v()(c)._id})}));case 2:200===e.sent.status&&(localStorage.setItem("@speech/room",i.room),window.location.replace("http://localhost:3000"));case 4:case"end":return e.stop()}})),s.a.createElement("div",null)):i.register?s.a.createElement(we,null):r?s.a.createElement(he,{show:o}):s.a.createElement(E,null,s.a.createElement(me,null))},ye=function(){return s.a.createElement(Ee,null)},Ne=a(49),Oe=a.n(Ne);var je=function(){return s.a.createElement("div",{className:Oe.a.container},s.a.createElement(ye,null))};a(90);o.a.render(s.a.createElement(je,null),document.getElementById("root"))}},[[50,1,2]]]);
//# sourceMappingURL=main.596e4dc7.chunk.js.map